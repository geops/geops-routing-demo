(this["webpackJsonpgeops-routing-demo"]=this["webpackJsonpgeops-routing-demo"]||[]).push([[0],{552:function(e,t,n){e.exports=n(960)},762:function(e,t,n){},764:function(e,t,n){},951:function(e,t,n){},952:function(e,t,n){},959:function(e,t,n){},960:function(e,t,n){"use strict";n.r(t);n(553),n(562),n(752);var r=n(0),a=n.n(r),o=n(28),c=n.n(o),i=n(25),u=n(95),l=n(466),s=n(72),d=n(214),p={center:[949042.143189,5899715.591163],currentMot:"rail",currentStops:["",""],currentStopsGeoJSON:{},clickLocation:null,notificationMessage:"",notificationType:"info",isFieldFocused:!1,showLoadingBar:!1,selectedRoutes:[],isRouteInfoOpen:!1,dialogPosition:{x:10,y:275},olMap:new d.a({controls:[]}),resolveHops:!1,tracks:[null,null]},f=function(e,t){var n={center:t.center};return Object(s.a)({},e,{},n)},m=function(e,t){var n={currentStops:t.currentStops};return Object(s.a)({},e,{},n)},h=function(e,t){var n={currentStopsGeoJSON:t.currentStopsGeoJSON};return Object(s.a)({},e,{},n)},g=function(e,t){var n={currentMot:t.currentMot};return Object(s.a)({},e,{},n)},b=function(e,t){var n={clickLocation:t.clickLocation};return Object(s.a)({},e,{},n)},v=function(e,t){var n={notificationMessage:t.notificationMessage,notificationType:t.notificationType};return Object(s.a)({},e,{},n)},O=function(e,t){var n={isFieldFocused:t.isFieldFocused};return Object(s.a)({},e,{},n)},y=function(e,t){var n={showLoadingBar:t.showLoadingBar};return Object(s.a)({},e,{},n)},S=function(e,t){var n={selectedRoutes:t.selectedRoutes};return Object(s.a)({},e,{},n)},E=function(e,t){var n={isRouteInfoOpen:t.isRouteInfoOpen};return Object(s.a)({},e,{},n)},j=function(e,t){var n={dialogPosition:t.dialogPosition};return Object(s.a)({},e,{},n)},k=function(e,t){var n={resolveHops:t.resolveHops};return Object(s.a)({},e,{},n)},R=function(e,t){var n={tracks:t.tracks};return Object(s.a)({},e,{},n)},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CENTER":return f(e,t);case"SET_CURRENT_STOPS":return m(e,t);case"SET_CURRENT_STOPS_GEOJSON":return h(e,t);case"SET_CURRENT_MOT":return g(e,t);case"SET_CLICK_LOCATION":return b(e,t);case"SHOW_NOTIFICATION":return v(e,t);case"SET_IS_FIELD_FOCUSED":return O(e,t);case"SET_SHOW_LOADING_BAR":return y(e,t);case"SET_SELECTED_ROUTES":return S(e,t);case"SET_IS_ROUTE_INFO_OPEN":return E(e,t);case"SET_DIALOG_POSITION":return j(e,t);case"SET_RESOLVE_HOPS":return k(e,t);case"SET_TRACKS":return R(e,t);default:return e}},C=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,N=Object(u.c)({MapReducer:w}),x=Object(u.e)(N,C(Object(u.a)(l.a))),M=n(37),P=n(177),F=n(120),T=n(255),I=n(256),_=n(121),L=n(273),A=n(492),H=n(262),V=n(82),G=n(494),D=n(257),U=n(269),z=n(66),B=n.n(z),J=n(130),W=n(132),K=n(270),q=n(458),Z=n(459),$=n(184),X=n(1022),Y=n(40),Q=n(1005),ee=n(1001),te=n(1019),ne=n(1017),re=n(1013),ae=n(1010),oe=n(1016),ce=n(1006),ie=n(278),ue=n(1015),le=n(1014),se=n(1024),de=n(1012),pe=n(477),fe=n.n(pe),me=n(478),he=n.n(me),ge=n(277),be=n(263),ve=n.n(be),Oe=function(e){return{type:"SET_CENTER",center:e}},ye=function(e){return{type:"SET_CURRENT_STOPS",currentStops:e}},Se=function(e){return{type:"SET_CURRENT_STOPS_GEOJSON",currentStopsGeoJSON:e}},Ee=function(e){return{type:"SET_CURRENT_MOT",currentMot:e}},je=function(e,t){return{type:"SHOW_NOTIFICATION",notificationMessage:e,notificationType:t}},ke=function(e){return{type:"SET_IS_FIELD_FOCUSED",isFieldFocused:e}},Re=function(e){return{type:"SET_SHOW_LOADING_BAR",showLoadingBar:e}},we=function(e){return{type:"SET_SELECTED_ROUTES",selectedRoutes:e}},Ce=function(e){return{type:"SET_IS_ROUTE_INFO_OPEN",isRouteInfoOpen:e}},Ne=function(e){return{type:"SET_TRACKS",tracks:e}},xe=(n(762),["rail","bus","foot"]),Me=["tram","subway","gondola","funicular","ferry","car"],Pe=[].concat(xe,Me),Fe=["foot","car"],Te=n(471),Ie=n.n(Te),_e=n(469),Le=n.n(_e),Ae=n(470),He=n.n(Ae),Ve=n(8),Ge=function(e){var t=null,n=e.charAt(0).toUpperCase()+e.slice(1);switch(e){case"rail":t=a.a.createElement(Le.a,null);break;case"foot":t=a.a.createElement(He.a,null);break;default:t=a.a.createElement(Ie.a,null)}return a.a.createElement("span",{title:n},t)},De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Object(Ve.n)(e,"EPSG:3857","EPSG:4326").map((function(e){return e.toFixed(t)}))},Ue=function(e){return Object(Ve.n)(e,"EPSG:4326","EPSG:3857")},ze=n(1002),Be=n(961),Je=n(1004),We=n(1003),Ke=n(335),qe=n.n(Ke),Ze=n(70),$e=(n(764),function(e,t,n,r){var a=[];return n?a.push("".concat(n).concat(e||t?":":"").concat(e?" ".concat(e):"").concat(t?" ".concat(t):"")):a.push("".concat(e?"".concat(e):"").concat(e&&t?" ":"").concat(t?"".concat(t):"")),r&&a.push("ifopt: ".concat(r)),a.filter((function(e){return""!==e})).join(", ")});function Xe(e){var t=e.currentSearchResults,n=e.processClickedResultHandler,o=Object(i.d)((function(e){return e.MapReducer.olMap})),c=Object(r.useState)(null),u=Object(Y.a)(c,2),l=u[0],s=u[1],d=Object(r.useRef)(),p=Object(r.useCallback)((function(){var e;d.current&&(e=o.getTarget().getBoundingClientRect().bottom-d.current.getBoundingClientRect().top-35);e>=0&&s(e)}),[o]);return Object(r.useEffect)((function(){var e=o.on("change:size",(function(){return p()}));return function(){Object(Ze.b)(e)}}),[]),Object(r.useEffect)((function(){p()}),[p,t]),0===t.length?null:a.a.createElement(ee.a,{square:!0,elevation:3,ref:d},a.a.createElement(ze.a,{component:"nav",className:"rd-result-list","aria-label":"search results",style:{maxHeight:l,overflowY:"scroll",paddingBottom:0,paddingTop:0}},t.map((function(e,t){return 0!==t?a.a.createElement(Be.a,{onClick:function(){n(e)},button:!0,key:ve()()},a.a.createElement(We.a,null,a.a.createElement(qe.a,null)),a.a.createElement(Je.a,{primary:e.properties.name,secondary:$e(e.properties.id,e.properties.code,e.properties.country_code,e.properties.ifopt)})):a.a.createElement(Be.a,{onClick:function(){return n(e)},button:!0,selected:!0,key:"searchResult-".concat(e.properties.name)},a.a.createElement(We.a,null,a.a.createElement(qe.a,null)),a.a.createElement(Je.a,{primary:e.properties.name,secondary:$e(e.properties.id,e.properties.code,e.properties.country_code,e.properties.ifopt)}))}))))}Xe.defaultProps={currentSearchResults:[]};var Ye=Xe,Qe=n(1021),et=n(1011),tt=n(475),nt=n.n(tt),rt=n(474),at=n.n(rt),ot=n(336),ct=n.n(ot),it=n(476),ut=n.n(it),lt=n(473),st=n.n(lt),dt=Object(Q.a)((function(){return{wrapper:{width:"12%",padding:"0 10px 4px 10px"}}})),pt=Object(Q.a)((function(){return{select:{paddingRight:"17px !important"},icon:{width:"0.8em",height:"0.8em"}}}));var ft=function(e){var t=e.index,n=e.disabled,o=dt(),c=pt(),u=Object(i.c)(),l=Object(i.d)((function(e){return e.MapReducer.tracks})),s=Object(i.d)((function(e){return e.MapReducer.currentMot})),d=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),p=Object(r.useMemo)((function(){return l[t]}),[t,l]),f=Object(r.useMemo)((function(){return d[t]&&d[t].properties&&d[t].properties.platforms&&d[t].properties.platforms[s]?[""].concat(Object(M.a)(d[t].properties.platforms[s].sort((function(e,t){return parseInt(e,10)-parseInt(t,10)})))):[]}),[t,s,d]);return a.a.createElement(ce.a,{className:o.wrapper},a.a.createElement(oe.a,{classes:c,renderValue:function(e){return""===e?"-":e},labelId:"rd-track-select-label",value:p,displayEmpty:!0,disabled:n||!f.length,onChange:function(e){var n=Object(M.a)(l),r=e.target.value;n[t]=r,u(Ne(n))}},f.map((function(e){return a.a.createElement(ae.a,{value:e,key:"track-".concat(e)},""===e?"-":e)}))))},mt=n(1),ht=n.n(mt),gt=ht.a.arrayOf(ht.a.number.isRequired).isRequired,bt=ht.a.shape({propTypeCoordinates:gt,type:ht.a.string.isRequired}),vt=ht.a.shape({geometry:bt,properties:ht.a.shape({id:ht.a.oneOfType([ht.a.string.isRequired,ht.a.string.isRequired]),type:ht.a.string.isRequired}),type:ht.a.string.isRequired}),Ot=ht.a.shape({features:ht.a.shape({0:ht.a.oneOfType([vt,gt]),1:ht.a.oneOfType([vt,gt])}),type:ht.a.string.isRequired}),yt=(ht.a.shape({0:Ot,1:Ot}),ht.a.arrayOf(ht.a.oneOfType([ht.a.string.isRequired,gt])),Object(Q.a)((function(){return{gridContainer:{width:"100%",padding:"0px 0px 0px 20px",boxSizing:"unset"},button:{color:"black","& svg":{height:"20px",width:"20px"}},fieldWrapper:{maxWidth:"58%"},buttonWrapper:{maxWidth:"26px"}}})));function St(e){var t,n=yt(),o=Object(i.c)(),c=e.index,u=e.addNewSearchFieldHandler,l=e.currentStops,s=e.removeSearchFieldHandler,d=e.searchStopsHandler,p=e.singleStop,f=e.processHighlightedResultSelectHandler,m=e.onFieldFocusHandler,h=e.onPanViaClick,g=e.inputReference,b=null,v=10,O="",y=null,S=Object(r.useMemo)((function(){return"string"===typeof p&&""!==p}),[p]),E=""===l[c]||l.length>2&&""===l[c+1];return 0===c?(b=a.a.createElement(se.a,{title:"Pan to the feature"},a.a.createElement(et.a,{onClick:function(){return h(p,c)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(st.a,{fontSize:"small",color:"primary"}))),O="Start",y=a.a.createElement(de.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(se.a,{title:"Add Hop"},a.a.createElement(et.a,{onClick:function(){return u(l,c+1)},disabled:E,className:n.button,"aria-label":"Add Hop",size:"small"},a.a.createElement(ct.a,{fontSize:"small"}))))):c===l.length-1?(b=a.a.createElement(se.a,{title:"Pan to the feature"},a.a.createElement(et.a,{onClick:function(){return h(p,c)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(at.a,{color:"primary"}))),O="End"):(b=a.a.createElement(se.a,{title:"Pan to the feature"},a.a.createElement(et.a,{onClick:function(){return h(p,c)},className:n.button,"aria-label":"Pan to the feature",size:"small"},a.a.createElement(nt.a,{fontSize:"small",color:"primary"}))),v=9,O="Hop",y=a.a.createElement(a.a.Fragment,null,a.a.createElement(de.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(se.a,{title:"Add Hop"},a.a.createElement(et.a,{disabled:E,onClick:function(){return u(l,c+1)},className:n.button,"aria-label":"addHop",size:"small"},a.a.createElement(ct.a,{fontSize:"small"})))),a.a.createElement(de.a,{item:!0,xs:1,className:n.buttonWrapper},a.a.createElement(se.a,{title:"Remove Hop"},a.a.createElement(et.a,{onClick:function(){return s(c)},className:n.button,"aria-label":"removeHop",size:"small"},a.a.createElement(ut.a,{fontSize:"small"})))))),a.a.createElement(de.a,{container:!0,spacing:1,className:n.gridContainer,alignItems:"flex-end"},a.a.createElement(de.a,{item:!0,xs:1},b),a.a.createElement(de.a,{item:!0,xs:v,className:n.fieldWrapper},a.a.createElement(Qe.a,{style:{width:"100%"},inputRef:g,label:O,color:"primary",onChange:function(e){return d(e,c)},value:(t=p,Array.isArray(t)?De(t):t),onKeyDown:f,onFocus:function(){o(ke(!0)),m(c)},onBlur:function(){return setTimeout((function(){o(ke(!1))}),500)},onClick:function(e){e.target.select&&e.target.select()}})),a.a.createElement(ft,{index:c,disabled:!S}),y)}St.defaultProps={currentStops:[],singleStop:""};var Et=St;function jt(e){var t=e.children,n=e.value,r=e.index;return a.a.createElement(ie.a,{component:"div",role:"tabpanel",hidden:n!==r,id:ve()(),"aria-labelledby":"simple-tab-".concat(r)},n===r&&t)}var kt=Object(Q.a)((function(){return{tabs:{width:"75%"},tab:{minWidth:"33%",width:"33%"},dropDown:{width:"25%",backgroundColor:"white"},select:{height:"100%"},selectInput:{backgroundColor:"white","&:focus":{backgroundColor:"white"}},checkbox:{margin:"0px 5px 0px 13px"}}})),Rt=new AbortController;function wt(e){var t=e.mots,n=e.stationSearchUrl,o=e.APIKey,c=e.isActiveRoute,u=e.onZoomRouteClick,l=e.onPanViaClick,d=e.onDrawNewRoute,p=kt(),f=Object(i.c)(),m=function(e,t){var n=[];return e.filter((function(e){return t.includes(e)})).forEach((function(e){var r=t.find((function(t){return t===e}));r&&n.push({name:r,icon:Ge(r)})})),0===n.length&&n.push({name:Pe[0],icon:Ge(Pe[0])}),n},h=m(t,xe),g=m(t,Me),b=Object(i.d)((function(e){return e.MapReducer.center})),v=Object(i.d)((function(e){return e.MapReducer.tracks})),O=Object(i.d)((function(e){return e.MapReducer.clickLocation})),y=Object(i.d)((function(e){return e.MapReducer.currentStops})),S=Object(i.d)((function(e){return e.MapReducer.showLoadingBar})),E=Object(i.d)((function(e){return e.MapReducer.isRouteInfoOpen})),j=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),k=Object(i.d)((function(e){return e.MapReducer.currentMot})),R=a.a.useRef([]);R.current.length!==y.length&&(R.current=Array(y.length).fill().map((function(e,t){return R.current[t]||a.a.createRef()})));var w=Object(r.useState)(h),C=Object(Y.a)(w,1)[0],N=Object(r.useState)(g),x=Object(Y.a)(N,1)[0],P=Object(r.useState)(null),F=Object(Y.a)(P,2),T=F[0],I=F[1],_=Object(r.useState)([]),L=Object(Y.a)(_,2),A=L[0],H=L[1],V=a.a.useState(!0),G=Object(Y.a)(V,2),D=G[0],U=G[1],z=Object(r.useState)(0),J=Object(Y.a)(z,2),W=J[0],K=J[1],q=Object(r.useState)(void 0),Z=Object(Y.a)(q,2),$=Z[0],X=Z[1];Object(r.useEffect)((function(){E&&f(we([]))}),[y]);var Q=function(e,t,n){f(ye(e)),f(Se(t)),K(n)},pe=function(e,t){var n=B.a.clone(j),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:O.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:O}}]},a=Object(M.a)(v);a[t-1]="",n[W]=r,Q(e,n,t),f(Ne(a)),f(Se(n))};Object(r.useEffect)((function(){if(O)if(""===y[W]){y[W]=O,pe(y,W+1<y.length?W+1:W)}else{var e=y,t=W;e[W]=O,pe(e,W);var n=B.a.clone(j),r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:O.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:O}}]};n[W]=r,Q(e,n,t),f(Se(n))}}),[O]);var me=function(e,t,n){var r=Object(M.a)(n).map((function(){return""}));X(null),f(Ne(r)),f(Ee(t))},be=function(e){K(e),f(ke(!0))},ve=function(e,t){var n=B.a.clone(y),r=B.a.clone(j);(n.splice(t,0,""),r[t])&&Object.keys(r).filter((function(e){return e>=t})).reverse().forEach((function(e){r["".concat(parseInt(e,10)+1)]=r[e]}));var a=Object(M.a)(v);a.splice(t,0,""),f(Ne(a)),f(ye(n)),f(Se(r))},Oe=function(e){var t=B.a.clone(y),n=B.a.clone(j);if(t.splice(e,1),n[e]){var r=Object.keys(n);r.forEach((function(t){var r=parseInt(t,10);r===e?delete n[e]:r>e&&(n[r-1]=n[r])})),delete n[r.length-1]}var a=Object(M.a)(v);a.splice(e,1),f(Ne(a)),f(ye(t)),f(Se(n))},Te=function(e,t){if(I(t),!e.target.value){var r=y;r[t]="",H([]),f(ye(r));var a=Object(M.a)(v);return a[t]="",f(Ne(a)),void f(Re(!1))}var c=B.a.clone(y);c[t]=e.target.value,f(ye(c)),f(Re(!0)),Rt.abort();var i=(Rt=new AbortController).signal,u="".concat(n,"?q=").concat(e.target.value,"&key=").concat(o).concat(Fe.includes(k)?"":"&mots=".concat(D?k:""),"&ref_location=").concat(De(b).reverse().join(","),"&limit=10");fetch(u,{signal:i}).then((function(e){return e.json()})).then((function(e){e.error?f(je("Couldn't find stations","warning")):(0===e.features.length&&f(je("Couldn't find stations","warning")),H(e.features),f(Re(!1)))})).catch((function(e){if("AbortError"!==e.name)throw e;console.warn("Abort ".concat(u))}))},Ie=function(e){var t=Object(Y.a)(A,1)[0];if("Enter"===e.key&&t){var n=y;Q[W]=t.properties.name;var r=B.a.clone(j);r[W]=t,f(ye(n)),H([]),f(Se(r))}if("Backspace"===e.key){var a=[];e.target.value&&(a=A);var o={};Object.keys(j).forEach((function(e){e!==W.toString()&&(o[e]=j[e])})),H(a),f(Se(o))}};return u&&l?a.a.createElement("div",{className:"rd-routing-menu"},a.a.createElement(ee.a,{square:!0,elevation:3},a.a.createElement("div",{className:"rd-routing-menu-header"},a.a.createElement(ne.a,{value:!!xe.includes(k)&&k,className:p.tabs,onChange:function(e,t){me(0,t,v)},indicatorColor:"primary",textColor:"primary","aria-label":"mots icons"},C.map((function(e){return a.a.createElement(re.a,{className:p.tab,key:"mot-".concat(e.name),value:e.name,icon:e.icon,"aria-label":e.name})}))),a.a.createElement(ce.a,{className:p.dropDown},a.a.createElement(oe.a,{renderValue:function(e){return""!==e?e:"Other MOTs"},className:p.select,classes:{root:p.selectInput},labelId:"rd-other-mot-label",value:$||"",disableUnderline:!$,displayEmpty:!0,onChange:function(e){if(e){var t=e.target.value;me(0,t,v),X(t)}else X(null)}},x.map((function(e){return a.a.createElement(ae.a,{value:e.name,key:"other-mot-".concat(e.name)},e.name)}))))),a.a.createElement(jt,null,a.a.createElement(ge.a,{onDragEnd:function(e){if(e.destination){var t=B.a.clone(y),n=t.splice(e.source.index,1),r=Object(Y.a)(n,1)[0];t.splice(e.destination.index,0,r);var a=B.a.clone(j),o=Object(s.a)({},a[e.source.index]);if(e.destination.index<e.source.index)Object.keys(a).filter((function(t){return parseInt(t,10)>=e.destination.index&&parseInt(t,10)<e.source.index})).reverse().forEach((function(e){a["".concat(parseInt(e,10)+1)]=a[e]})),a[e.destination.index]=o;else if(e.destination.index>e.source.index){Object.keys(a).filter((function(t){return parseInt(t,10)>=e.source.index&&parseInt(t,10)<=e.destination.index})).forEach((function(t){parseInt(t,10)===e.destination.index?a[e.destination.index]=o:a[t]=a["".concat(parseInt(t,10)+1)]}))}var c=Object(M.a)(v);!function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}(c,e.source.index,e.destination.index),f(Ne(c)),f(ye(t)),f(Se(a))}}},a.a.createElement(ge.c,{droppableId:"droppable"},(function(e){return a.a.createElement("div",Object.assign({className:"stopsContainer"},e.droppableProps,{ref:e.innerRef,style:{background:"white"}}),y.map((function(e,t){return a.a.createElement(ge.b,{key:"searchField-".concat(t),draggableId:"searchField-".concat(t),index:t},(function(n,r){return a.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{style:(o=r.isDragging,c=n.draggableProps.style,Object(s.a)({userSelect:"none",background:o?"#ededed":"white"},c))}),a.a.createElement(Et,{key:"searchField-".concat(t),index:t,inputReference:R.current[t],addNewSearchFieldHandler:ve,currentStops:y,removeSearchFieldHandler:Oe,searchStopsHandler:Te,singleStop:e,processHighlightedResultSelectHandler:Ie,onFieldFocusHandler:be,onPanViaClick:l}));var o,c}))})),e.placeholder)}))),a.a.createElement("div",{className:"rd-mot-checkbox"},a.a.createElement(te.a,{className:p.checkbox,checked:D,onChange:function(){U(!D),null!==T&&Te({target:{value:R.current[T].current.value}},T)},color:"primary",inputProps:{"aria-label":"use only mot"}}),a.a.createElement("span",null,"Search only selected mode of transport")),a.a.createElement("div",{className:"rd-route-buttons"},a.a.createElement(de.a,{item:!0,xs:6},a.a.createElement(se.a,{title:"Zoom to the route"},a.a.createElement(le.a,{onClick:function(){return u()},"aria-label":"Zoom to the route",disabled:!c,variant:"contained",color:"default",classes:{root:"rd-button-root",disabled:"rd-button-disabled"},startIcon:a.a.createElement(fe.a,{fontSize:"small"})},a.a.createElement(ie.a,null,"Zoom to the route")))),a.a.createElement(de.a,{item:!0,xs:6},a.a.createElement(se.a,{title:"Route information"},a.a.createElement(le.a,{onClick:function(){d(!0).then((function(){f(Ce(!E))}))},"aria-label":"Route information",disabled:!c,variant:"contained",color:"default",className:E?"rd-button-active":"",classes:{root:"rd-button-root",disabled:"rd-button-disabled"},startIcon:a.a.createElement(he.a,{fontSize:"small"})},a.a.createElement(ie.a,null,"Route information")))))),S?a.a.createElement(ue.a,null):null),a.a.createElement(Ye,{currentSearchResults:A,processClickedResultHandler:function(e){var t=y;t[W]=e.properties.name;var n=B.a.clone(j);n[W]=e,f(ye(t));var r=Object(M.a)(v);r[W]="",f(Ne(r)),H([]),Object.keys(n).forEach((function(e){e===W.toString()&&(n[e].geometry.coordinates=Ue(n[e].geometry.coordinates))})),f(Se(n))}})):null}jt.defaultProps={value:null,index:null},wt.defaultProps={onZoomRouteClick:void 0,onPanViaClick:void 0};var Ct=wt,Nt=n(479),xt=n.n(Nt),Mt=n(480),Pt=n.n(Mt),Ft=n(493),Tt=n(107);function It(){return(It=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _t(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Lt=a.a.createElement("path",{strokeWidth:4,fill:"none",stroke:"#ff7f50",d:"M0,16h10.666666666666666             A5.333333333333333,5.333333333333333,0,1,1,21.333333333333332,16             H32M21.333333333333332,16             A5.333333333333333,5.333333333333333,0,1,1,10.666666666666666,16",className:"recharts-legend-icon"}),At=function(e){var t=e.svgRef,n=e.title,r=_t(e,["svgRef","title"]);return a.a.createElement("svg",It({className:"recharts-surface",viewBox:"0 0 32 32",ref:t},r),n?a.a.createElement("title",null,n):null,Lt)},Ht=a.a.forwardRef((function(e,t){return a.a.createElement(At,It({svgRef:t},e))}));n.p;function Vt(){return(Vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Gt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Dt=a.a.createElement("path",{strokeWidth:4,fill:"none",stroke:"#3f51b5",d:"M0,16h10.666666666666666             A5.333333333333333,5.333333333333333,0,1,1,21.333333333333332,16             H32M21.333333333333332,16             A5.333333333333333,5.333333333333333,0,1,1,10.666666666666666,16",className:"recharts-legend-icon"}),Ut=function(e){var t=e.svgRef,n=e.title,r=Gt(e,["svgRef","title"]);return a.a.createElement("svg",Vt({className:"recharts-surface",viewBox:"0 0 32 32",ref:t},r),n?a.a.createElement("title",null,n):null,Dt)},zt=a.a.forwardRef((function(e,t){return a.a.createElement(Ut,Vt({svgRef:t},e))})),Bt=(n.p,n(951),function(e,t){return"".concat(t?Math.round(100*e)/100:Math.round(e/1e3*100)/100)}),Jt=function(e,t,n){for(var r=[],a=n||0;a<e.length;a+=t||1)r.push(e[a]);return r},Wt=function(e,t){var n=e/t*300;return n>=80?n:80};function Kt(e){var t,n,o=e.routes,c=e.hoveredCoords,u=e.onHighlightPoint,l=e.clearHighlightPoint,s=Object(i.c)(),d=Object(r.useState)(null),p=Object(Y.a)(d,2),f=p[0],m=p[1],h=Object(r.useState)(null),g=Object(Y.a)(h,2),b=g[0],v=g[1],O=Object(r.useState)(0),y=Object(Y.a)(O,2),S=y[0],E=y[1],j=Object(r.useState)(null),k=Object(Y.a)(j,2),R=k[0],w=k[1],C=Object(r.useState)([]),N=Object(Y.a)(C,2),x=N[0],P=N[1],F=Object(r.useState)(null),T=Object(Y.a)(F,2),I=T[0],_=T[1],L=Object(r.useState)(null),A=Object(Y.a)(L,2),H=A[0],V=A[1],G=Object(i.d)((function(e){return e.MapReducer.dialogPosition}));return Object(r.useEffect)((function(){var e,t,n,r=[],a=(e=[]).concat.apply(e,Object(M.a)(o.map((function(e){return e.getGeometry().getFlatCoordinates()})))),c=(t=[]).concat.apply(t,Object(M.a)(o.map((function(e){return e.get("vertex_distances")})))),i=o.map((function(e){return e.get("line_length")})).reduce((function(e,t){return e+t}),0);v(i),_(i>1e3?"km":"m"),V("m"===I);var u=Jt(a,3,0),l=Jt(a,3,1),s=Jt(a,3,2).map((function(e){return Math.round(e)})),d=(n=[]).concat.apply(n,Object(M.a)(o.map((function(e){return e.get("surface_elevations").map((function(e){return Math.round(e)}))}))));E(Math.min.apply(Math,Object(M.a)(d.concat(s)))),w(Math.max.apply(Math,Object(M.a)(d.concat(s)))),s.forEach((function(e,t){r.push({alt:e,surfaceElevation:d.length?d[t]:null,xVal:u[t],yVal:l[t],distance:c[t]})})),P(r)}),[o]),a.a.createElement(Ft.a,{isOpen:!0,title:a.a.createElement("span",null,"Route information"),isDraggable:!0,onDragStop:function(e,t){s(function(e){return{type:"SET_DIALOG_POSITION",dialogPosition:e}}({x:t.lastX,y:t.lastY}))},className:"rd-dialog-container",classNameHeader:"rd-dialog-header",classNameCloseBt:"rd-dialog-close-bt",cancelDraggable:".tm-dialog-body",position:G,onClose:function(){return s(Ce(!1))}},a.a.createElement("div",{className:"rd-dialog-legend"},a.a.createElement(zt,null)," surface elevation",a.a.createElement(Ht,null)," interpolated altitude"),a.a.createElement(Tt.d,{width:450,height:200,data:x,onMouseLeave:l},a.a.createElement(Tt.i,{type:"number",axisLine:!1,tickLine:!1,domain:[S-10,"dataMax"]},a.a.createElement(Tt.b,{value:"m",offset:10,position:"top"})),a.a.createElement(Tt.h,{type:"number",dataKey:"distance",tickFormatter:function(e){return Bt(e,H)}},a.a.createElement(Tt.b,{value:I,offset:10,position:"right"})),a.a.createElement(Tt.a,{vertical:!1}),a.a.createElement(Tt.c,{type:"monotone",dataKey:"alt",name:"interpolated altitude",dot:!1,stroke:"#ff7f50",strokeWidth:2}),a.a.createElement(Tt.c,{type:"monotone",dataKey:"surfaceElevation",name:"surface elevation",dot:!1,stroke:"#3f51b5",strokeWidth:2}),c&&f&&a.a.createElement(Tt.f,{x:f.distance,stroke:"lightgrey"}),c&&f&&a.a.createElement(Tt.e,{r:4,x:f.distance,y:f.alt,fill:"#3f51b5",stroke:"white"}),a.a.createElement(Tt.g,{cursor:!!f||"auto",position:f?{x:Wt(f.distance,b),y:(t=f.alt,n=R,t/n>.5?110:20)}:"auto",content:function(e){return c?function(e,t,n){for(var r=new W.a,o=Pt()(r.writeFeaturesObject(n,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})).features[0],c=new D.a({geometry:new J.a(e)}),i=r.writeFeatureObject(c,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),u=xt()(o,i),l=o.geometry.coordinates,s=l.map((function(e){return e[u.properties.index]})),d=s.reduce((function(e,t){var n=u.geometry.coordinates[0];return e?t&&e&&Math.abs(t[0]-n)<Math.abs(e[0]-n)?t:e:t})),p=s.indexOf(d),f=u.properties.index,h=0;h<p;h+=1)f+=l[h].length;var g=t[f];return m(g),g?a.a.createElement("div",{className:"rd-tootip-wrapper"},a.a.createElement("div",null,"surface elevation: ",g.surfaceElevation," m"),a.a.createElement("div",null,"interpolated altitude: ",g.alt," m"),a.a.createElement("div",null,"distance: ",Bt(g.distance,H),H?" m":" km")):null}(c,x,o):function(e){if(f&&m(null),e.payload.length){var t=e.payload[0].payload,n=t.xVal,r=t.yVal,o=t.alt,c=t.surfaceElevation,i=t.distance;return u([n,r]),a.a.createElement("div",{className:"rd-tootip-wrapper"},a.a.createElement("div",null,"surface elevation: ",c," m"),a.a.createElement("div",null,"interpolated altitude: ",o," m"),a.a.createElement("div",null,"distance: ",Bt(i,H),H?" m":" km"))}}(e)}})))}Kt.defaultProps={hoveredCoords:null};var qt=a.a.memo(Kt),Zt=n(210),$t=n(216),Xt=n(339),Yt=n(274),Qt=function(e){return e.map((function(e){return new Zt.c({stroke:new $t.a({color:e[0],width:e[1],lineDash:e[2]})})}))},en=Qt([["darkred",6],["red",3]]),tn=Qt([["darkred",7],["red",4]]),nn=Qt([["rgb(153,153,0)",6],["yellow",3]]),rn=Qt([["rgb(153,153,0)",7],["yellow",4]]),an=Qt([["rgb(96, 186, 219)",6],["rgb(173, 216, 230)",3]]),on=Qt([["rgb(96, 186, 219)",7],["rgb(173, 216, 230)",4]]),cn=Qt([["grey",6],["darkgrey",3]]),un=Qt([["grey",7],["darkgrey",4]]),ln=Qt([["darkblue",6],["blue",3]]),sn=Qt([["darkblue",7],["blue",4]]),dn=new Zt.c({image:new Xt.a({radius:7,fill:new Yt.a({color:"red"}),stroke:new $t.a({color:"darkred",width:2})})}),pn=new Zt.c({image:new Xt.a({radius:3,fill:new Yt.a({color:"rgb(173, 216, 230)"}),stroke:new $t.a({color:"rgb(96, 186, 219)",width:2})})}),fn=new Zt.c({image:new Xt.a({radius:3,fill:new Yt.a({color:"darkgrey"}),stroke:new $t.a({color:"grey",width:2})})}),mn=new Zt.c({image:new Xt.a({radius:7,fill:new Yt.a({color:"yellow"}),stroke:new $t.a({color:"rgb(153,153,0)",width:2})})}),hn=new Zt.c({image:new Xt.a({radius:7,fill:new Yt.a({color:"blue"}),stroke:new $t.a({color:"darkblue",width:2})})}),gn=function(e){return"rail"===e?dn:"bus"===e?mn:"foot"===e?pn:"car"===e?fn:hn},bn=function(e,t){return"rail"===e?t?tn:en:"bus"===e?t?rn:nn:"foot"===e?t?on:an:"car"===e?t?un:cn:t?sn:ln},vn=(n(952),new AbortController),On=function(e){function t(e){var n;Object(P.a)(this,t),(n=Object(T.a)(this,Object(I.a)(t).call(this,e))).onMapMoved=function(e){var t=n.props,r=t.center,a=t.onSetCenter,o=e.map.getView().getCenter();r[0]===o[0]&&r[1]===o[1]||a(o)},n.drawNewRoute=function(e){var t=[],r=n.props,a=r.currentStopsGeoJSON,o=r.routingUrl,c=r.currentMot,i=r.APIKey,u=r.resolveHops,l=r.onShowNotification,s=r.onSetShowLoadingBar,d=r.onSetSelectedRoutes,p=r.tracks,f=r.isRouteInfoOpen;s(!0),Object.keys(a).forEach((function(e,n){a[e].features?t.push("".concat(De(a[e].features[0].geometry.coordinates).slice().reverse())):Fe.includes(c)?t.push("".concat(a[e].properties.name)):t.push("!".concat(a[e].properties.uid).concat(null!==p[n]?"".concat(p[n]?"$".concat(p[n]):""):""))})),vn.abort();var m=(vn=new AbortController).signal,h=!(!f&&!e),g="".concat(o,"?via=").concat(t.join("|"),"&mot=").concat(c,"&resolve-hops=").concat(u,"&key=").concat(i)+"&elevation=".concat(h?1:0)+"&interpolate_elevation=".concat(h)+"&length=true&coord-radius=100.0&coord-punish=1000.0";return fetch(g,{signal:m}).then((function(e){return e.json()})).then((function(e){if(s(!1),e.error)return l("Couldn't find route","error"),void d([]);n.routeVectorSource.clear();var t=new W.a({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});n.routeVectorSource.addFeatures(t.readFeatures(e)),n.setIsActiveRoute(!!n.routeVectorSource.getFeatures().length),d(n.routeVectorSource.getFeatures()),n.routeVectorLayer.olLayer.setStyle(bn(c,!1))})).catch((function(e){if("AbortError"!==e.name)throw s(!1),d([]),e;console.warn("Abort ".concat(g))}))};var a=n.props,o=a.APIKey,c=a.onSetClickLocation,i=a.olMap;n.map=i,n.mapRef=Object(r.createRef)(),n.hoveredFeature=null,n.hoveredRoute=null,n.initialRouteDrag=null,n.state={hoveredStationOpen:!1,hoveredStationName:"",isActiveRoute:!1,hoveredPoint:null},n.onHighlightPoint=n.onHighlightPoint.bind(Object(_.a)(n)),n.projection="EPSG:3857";var u=new H.a(A.a.readConfig([{name:"Basemap",visible:!0,isBaseLayer:!0,data:{type:"mapbox",url:"https://maps.geops.io/styles/travic/style.json?key=".concat(o)}}]));n.routeVectorSource=new K.a({features:[]}),u.addLayer(new V.a({key:"routeLayer",name:"routeLayer",olLayer:new U.a({zIndex:1,source:n.routeVectorSource})})),n.highlightVectorSource=new K.a({}),u.addLayer(new V.a({key:"highlightLayer",name:"highlightLayer",olLayer:new U.a({zIndex:1,source:n.highlightVectorSource})})),n.markerVectorSource=new K.a({}),u.addLayer(new V.a({key:"markerLayer",name:"markerLayer",olLayer:new U.a({zIndex:1,source:n.markerVectorSource})})),n.markerVectorLayer=u.getLayer("markerLayer"),n.routeVectorLayer=u.getLayer("routeLayer"),n.layers=Object(M.a)(u.getLayers());var l=new q.a({layers:[n.markerVectorLayer.olLayer],hitTolerance:3});l.on("translateend",(function(e){var t,r=n.props,a=r.tracks,o=r.onSetTracks,c=r.currentStops,i=r.currentStopsGeoJSON,u=r.onSetCurrentStops,l=r.onSetCurrentStopsGeoJSON,s=B.a.clone(a),d=B.a.clone(c),p=B.a.clone(i),f=e.features.getArray()[0].getProperties(),m=f.name,h=f.id;if(m)t=c.indexOf(m);else{t=c.findIndex((function(e){if(!Array.isArray(e))return!1;var t=h.slice().reverse();return e[0]===t[0]&&e[1]===t[1]}))}-1!==t&&(s[t]="",d[t]=e.coordinate,p[t]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.coordinate}}]},o(s),u(d),l(p))}));var s=new Z.a({source:n.routeVectorSource,pixelTolerance:4,condition:function(){var e=n.props.currentMot;return!Fe.includes(e)},style:function(){var e=n.props.currentMot;return gn(e)}});return s.on("modifystart",(function(e){n.initialRouteDrag={features:e.features.getArray(),coordinate:e.mapBrowserEvent.coordinate}})),s.on("modifyend",(function(e){var t=n.initialRouteDrag.features,r=n.props,a=r.tracks,o=r.currentMot,c=r.currentStops,i=r.currentStopsGeoJSON,u=r.onSetTracks,l=r.onSetCurrentStops,s=r.onSetCurrentStopsGeoJSON,d=Object(M.a)(a),p=B.a.clone(c),f=B.a.clone(i),m=-1;if(!Fe.includes(o)){var h=t.map((function(e){return e.getGeometry()})).map((function(e){return[].concat(Object(M.a)(e.getFirstCoordinate()),Object(M.a)(e.getLastCoordinate()))})),g=n.routeVectorSource.getClosestFeatureToCoordinate(n.initialRouteDrag.coordinate).getGeometry(),b=[].concat(Object(M.a)(g.getFirstCoordinate()),Object(M.a)(g.getLastCoordinate()));h.forEach((function(e,t){e.length===b.length&&e.every((function(e,t){return e===b[t]}))&&(m=t+1)}))}if(m>=0){if(p.splice(m,0,e.mapBrowserEvent.coordinate),d.splice(m,0,""),f[m])Object.keys(f).reverse().forEach((function(t){parseInt(t,10)>=m&&(f["".concat(parseInt(t,10)+1)]=f[t]),parseInt(t,10)===m&&(f[m]={type:"FeatureCollection",features:[{type:"Feature",properties:{id:e.mapBrowserEvent.coordinate.slice().reverse(),type:"coordinates"},geometry:{type:"Point",coordinates:e.mapBrowserEvent.coordinate}}]})}));u(d),l(p),s(f)}n.initialRouteDrag=null})),Object($.a)().extend([l,s]).getArray().forEach((function(e){n.map.addInteraction(e)})),n.onZoomRouteClick=function(){var e;n.routeVectorSource.getFeatures().length&&(e=n.routeVectorSource.getExtent()),4===e.filter((function(e){return Number.isFinite(e)})).length&&n.map.getView().fit(n.routeVectorSource.getExtent(),{size:n.map.getSize(),duration:500,padding:[200,200,200,200]})},n.onPanViaClick=function(e,t){var r=n.props.currentStopsGeoJSON;if(r&&r[t]){var a=r[t].features?r[t].features[0].geometry.coordinates:r[t].geometry.coordinates;n.map.getView().animate({center:a,duration:500,padding:[100,100,100,100]})}},n.map.on("singleclick",(function(e){var t=n.props,r=t.isFieldFocused;(t.currentStops.includes("")||r)&&c(e.coordinate)})),n.map.on("pointermove",(function(e){var t=n.props.currentMot;n.hoveredFeature&&(n.hoveredFeature=null,n.setState({hoveredStationOpen:!1,hoveredStationName:""})),n.hoveredRoute&&(n.routeVectorLayer.olLayer.setStyle(bn(t,!1)),n.hoveredRoute=null,n.setState({hoveredPoint:null})),n.map.getFeaturesAtPixel(e.pixel,{hitTolerance:2}).forEach((function(t){if("Point"===t.getGeometry().getType()){n.hoveredFeature=t;var r="",a=t.get("country_code");r=t.get("name")?"".concat(t.get("name")).concat(a?" - ".concat(a):""):"".concat(De(t.getGeometry().flatCoordinates)),n.setState({hoveredStationOpen:!0,hoveredStationName:r})}return"LineString"===t.getGeometry().getType()&&(n.hoveredRoute=t,n.setState({hoveredPoint:e.coordinate})),!0}))})),n}return Object(L.a)(t,e),Object(F.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,r=n.currentStopsGeoJSON,a=n.currentMot,o=n.tracks,c=a&&a!==e.currentMot,i=o!==e.tracks,u=r&&r!==e.currentStopsGeoJSON;(c||u||i)&&(this.markerVectorSource.clear(),Object.keys(r).forEach((function(e){t.markerVectorSource.addFeatures((new W.a).readFeatures(r[e])),t.markerVectorSource.getFeatures().forEach((function(e){return e.setStyle(gn(a))}))})),this.routeVectorSource.clear(),this.setIsActiveRoute(!1),Object.keys(r).length>1&&this.drawNewRoute())}},{key:"onHighlightPoint",value:function(e){var t=this.props.currentMot;this.highlightVectorSource.clear();var n=new D.a({geometry:new J.a(e)});n.setStyle(gn(t)),this.highlightVectorSource.addFeatures([n])}},{key:"onFeaturesHover",value:function(e){this.mapRef&&(this.mapRef.current.node.current.style.cursor=e.length?"pointer":"inherit")}},{key:"setIsActiveRoute",value:function(e){this.setState({isActiveRoute:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.center,r=t.mots,o=t.APIKey,c=t.selectedRoutes,i=t.isRouteInfoOpen,u=t.stationSearchUrl,l=this.state,s=l.isActiveRoute,d=l.hoveredPoint,p=l.hoveredStationOpen,f=l.hoveredStationName;return a.a.createElement(a.a.Fragment,null,a.a.createElement(Ct,{mots:r,stationSearchUrl:u,isActiveRoute:s,onZoomRouteClick:this.onZoomRouteClick,onPanViaClick:this.onPanViaClick,onDrawNewRoute:this.drawNewRoute,APIKey:o}),a.a.createElement(X.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:p,message:f}),a.a.createElement(G.a,{ref:this.mapRef,center:n,layers:this.layers,onMapMoved:function(t){return e.onMapMoved(t)},onFeaturesHover:function(t){return e.onFeaturesHover(t)},zoom:6,tabIndex:null,map:this.map,viewOptions:{projection:this.projection}}),i&&c.length?a.a.createElement(qt,{routes:c,hoveredCoords:d,onHighlightPoint:this.onHighlightPoint,clearHighlightPoint:function(){e.highlightVectorSource.clear()}}):null)}}]),t}(r.Component);On.getExtentCenter=function(e){return[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2]},On.indexInGeom=function(e,t){return e.indexOf(t[0])===e.indexOf(t[1])-1};var yn=Object(i.b)((function(e){return{center:e.MapReducer.center,selectedRoutes:e.MapReducer.selectedRoutes,isRouteInfoOpen:e.MapReducer.isRouteInfoOpen,currentMot:e.MapReducer.currentMot,currentStops:e.MapReducer.currentStops,currentStopsGeoJSON:e.MapReducer.currentStopsGeoJSON,isFieldFocused:e.MapReducer.isFieldFocused,resolveHops:e.MapReducer.resolveHops,olMap:e.MapReducer.olMap,tracks:e.MapReducer.tracks}}),(function(e){return{onSetCenter:function(t){return e(Oe(t))},onSetTracks:function(t){return e(Ne(t))},onSetCurrentStops:function(t){return e(ye(t))},onSetCurrentStopsGeoJSON:function(t){return e(Se(t))},onSetClickLocation:function(t){return e(function(e){return{type:"SET_CLICK_LOCATION",clickLocation:e}}(t))},onShowNotification:function(t,n){return e(je(t,n))},onSetShowLoadingBar:function(t){return e(Re(t))},onSetSelectedRoutes:function(t){return e(we(t))}}}))(On),Sn=n(495),En=n(491),jn=n.n(En),kn=(new AbortController).signal,Rn=function(e,t,n){if(e.split(",").length>1){var r,a=e.split(",").filter((function(e){return!isNaN(e)})).map((function(e){return parseFloat(e)}));if(2===a.length&&function(e){return!!(isFinite(e[1])&&Math.abs(e[1])<=90&&isFinite(e[0])&&Math.abs(e[0])<=180)}(a)){var o=Ue(a);r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:o,type:"coordinates"},geometry:{type:"Point",coordinates:o}}]}}return Promise.resolve(r)}var c;return c=/^![a-zA-Z0-9]{16}$/.test(e)?"".concat(n,"lookup/").concat(e.replace("!",""),"/?key=").concat(t):"".concat(n,"?q=").concat(e.replace("!",""),"&key=").concat(t),fetch(c,{signal:kn}).then((function(e){return e.json()})).then((function(e){var t=e.features[0];return t.geometry.coordinates=Ue(e.features[0].geometry.coordinates),t})).catch((function(){return console.error("Failed to fetch geoJson"),null}))};var wn=function(e){var t=e.mots,n=e.APIKey,o=e.stationSearchUrl,c=Object(i.c)(),u=jn.a.parse(window.location.search),l=Object(i.d)((function(e){return e.MapReducer.center})),s=Object(i.d)((function(e){return e.MapReducer.tracks})),d=Object(i.d)((function(e){return e.MapReducer})),p=Object(i.d)((function(e){return e.MapReducer.currentMot})),f=Object(i.d)((function(e){return e.MapReducer.currentStops})),m=Object(i.d)((function(e){return e.MapReducer.currentStopsGeoJSON})),h=Object(i.d)((function(e){return e.MapReducer.resolveHops})),g=d.olMap,b=Object(r.useState)({}),v=Object(Y.a)(b,2),O=v[0],y=v[1];return Object(r.useEffect)((function(){var e={};if(u){if(u.z&&!isNaN(parseFloat(u.z))&&g.getView().setZoom(u.z),u.x&&!isNaN(parseFloat(u.x))&&u.y&&!isNaN(parseFloat(u.y))&&c(Oe([parseFloat(u.x),parseFloat(u.y)])),u.mot){var r=t.find((function(e){return e===u.mot}))||t[0];e.mot=r,c(Ee(r))}if(u.via){e.via=u.via;var a=u.via.split("|"),i=a.map((function(e){return Rn(e.split("$")[0],n,o)}));c(Ne(a.map((function(e){return e.split("$")[1]||""})))),Promise.all(i).then((function(e){c(ye(e.map((function(e){return e?"FeatureCollection"===e.type?e.features[0].geometry.coordinates:e.properties.name:""}))));var t={};e.filter((function(e){return!!e})).forEach((function(e,n){return t["".concat(n)]=e})),c(Se(t))}))}u["resolve-hops"]&&c(function(e){return{type:"SET_RESOLVE_HOPS",resolveHops:e}}("true"===u["resolve-hops"]))}y(e)}),[]),Object(r.useEffect)((function(){var e={};e.z=g.getView().getZoom();var t=Object(Y.a)(l,1);e.x=t[0];var n=Object(Y.a)(l,2);e.y=n[1],e.mot=p,e["resolve-hops"]=h,0!==Object.keys(m).length&&(e.via=function(e,t){return!e||Object.keys(e).length<2?null:Object.keys(e).map((function(n,r){return e[n].features?"".concat(De(e[n].features[0].geometry.coordinates)):"!".concat(e[n].properties.uid).concat(t[r]?"$".concat(t[r]):"")})).join("|")}(m,s)),y(e)}),[p,f,m,l,h,g,s]),a.a.createElement(Sn.a,{map:g,params:O})},Cn=n(1018),Nn=function(e){function t(e){var n;return Object(P.a)(this,t),(n=Object(T.a)(this,Object(I.a)(t).call(this,e))).handleOpen=function(){n.setState({open:!0})},n.handleClose=function(){var e=n.props.onShowNotification;n.setState({open:!1}),e(null,"error")},n.state={open:!1},n}return Object(L.a)(t,e),Object(F.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.notificationMessage;t&&t!==e.notificationMessage&&this.handleOpen()}},{key:"render",value:function(){var e=this.props,t=e.notificationMessage,n=e.notificationType,r=this.state.open;return a.a.createElement(X.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:r,autoHideDuration:6e3,onClose:this.handleClose},a.a.createElement(Cn.a,{onClose:this.handleClose,severity:n,elevation:6,variant:"filled"},t))}}]),t}(a.a.Component),xn=Object(i.b)((function(e){return{notificationMessage:e.MapReducer.notificationMessage,notificationType:e.MapReducer.notificationType}}),(function(e){return{onShowNotification:function(t,n){return e(je(t,n))}}}))(Nn),Mn={mots:Pe,routingUrl:"https://api.geops.io/routing/v1/",stationSearchUrl:"https://api.geops.io/stops/v1/"};function Pn(e){var t=e.mots,n=e.routingUrl,r=e.stationSearchUrl,o="5cc87b12d7c5370001c1d655012b7edc8da1475084e49b84b6ba658e";return a.a.createElement(i.a,{store:x},a.a.createElement(wn,{mots:t,APIKey:o,stationSearchUrl:r}),a.a.createElement(yn,{mots:t,routingUrl:n,APIKey:o,stationSearchUrl:r}),a.a.createElement(xn,null))}Pn.defaultProps=Mn;var Fn=Pn;n(959),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(Fn,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[552,1,2]]]);
//# sourceMappingURL=main.3d29f880.chunk.js.map